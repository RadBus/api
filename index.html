<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="RadBus Web API : REST API Documentaion" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>RadBus Web API</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/TargetRAD/radbus-api">View on GitHub</a>

          <h1 id="project_title">RadBus Web API</h1>
          <h2 id="project_tagline">REST API Documentaion</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/TargetRAD/radbus-api/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/TargetRAD/radbus-api/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p>The RabBus Web API enables applications to obtain upcoming Twin Cities Metro Transit departure information for users with configured route schedules.  The most practical use case is when an end user has multiple transit route/stop options and needs to make a quick decision right now on which one makes the most sense.</p>

<p>RadBus is an open source project built by people participating in the Twin Cities open source community who rely on Metro Transit to get to and from work every day.  To see the source code behind this API and learn about contributing to the project, click the GitHub icon at the top of this page.  To see a working RadBus client, check out the <a href="https://www.radbus.io">RadBus Web Client</a>.</p>

<h2>
<a name="version-1-api" class="anchor" href="#version-1-api"><span class="octicon octicon-link"></span></a>Version 1 API</h2>

<h3>
<a name="authentication" class="anchor" href="#authentication"><span class="octicon octicon-link"></span></a>Authentication</h3>

<p>Many RadBus API endpoints require requests to be authenticated since they need access to a user's personal schedule configuration.  Rather than store user credentials internally, RadBus uses <a href="http://tools.ietf.org/html/rfc6750">OAuth2 Authorization</a> to identify the user and then is able to look up their RadBus data.</p>

<h4>
<a name="creating-an-oauth2-token" class="anchor" href="#creating-an-oauth2-token"><span class="octicon octicon-link"></span></a>Creating an OAuth2 Token</h4>

<p>To use a request that requires authentication you must pass an <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.8">Authorization</a> HTTP header with a <code>Bearer</code> token obtained by a supported OAuth2 provider.  Currently the RadBus API only supports OAuth2 tokens generated from Google ID's, which you can learn more about <a href="https://developers.google.com/accounts/docs/OAuth2">here</a>.</p>

<p>When obtaining your OAuth2 token, one of the inputs is called <strong>scopes</strong>.  RadBus requires a specific scopes value in order to access the correct user information so their schedule can be looked up.  The client should call the <a href="#oauth2-scopes-resource">OAuth2 Scopes</a> resource to obtain the correct scopes value.</p>

<h4>
<a name="authentication-failure-responses" class="anchor" href="#authentication-failure-responses"><span class="octicon octicon-link"></span></a>Authentication Failure Responses</h4>

<p>Any endpoint that requires authentication can produce the following errors:</p>

<p><code>401 Unauthorized</code></p>

<ul>
<li>No <code>Authorization</code> request header was passed.</li>
<li>The OAuth2 token in the <code>Authorization</code> request header was created using the wrong scopes value.  See the <a href="#creating-an-oauth2-token">Creating an OAuth2 Token</a> section above for information on how to use the right scopes value.</li>
<li>The OAuth2 token in the <code>Authorization</code> request header has expired.  When this happens, the client should generate a new token and call the same RadBus API endpoint again.</li>
</ul><h3>
<a name="root-resource" class="anchor" href="#root-resource"><span class="octicon octicon-link"></span></a>Root Resource</h3>

<p>Provides description and version information about the v1 API.</p>

<h4>
<a name="fetch-get-v1" class="anchor" href="#fetch-get-v1"><span class="octicon octicon-link"></span></a>Fetch (GET /v1)</h4>

<h5>
<a name="sample-request" class="anchor" href="#sample-request"><span class="octicon octicon-link"></span></a>Sample Request</h5>

<pre><code>GET https://api.radbus.io/v1
</code></pre>

<h5>
<a name="sample-success-response" class="anchor" href="#sample-success-response"><span class="octicon octicon-link"></span></a>Sample Success Response</h5>

<p><code>200 OK</code></p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
  <span class="nt">"service_name"</span><span class="p">:</span> <span class="s2">"RadBus Web API"</span><span class="p">,</span>
  <span class="nt">"app_version"</span><span class="p">:</span> <span class="s2">"0.1.0"</span><span class="p">,</span>
  <span class="nt">"api_version"</span><span class="p">:</span> <span class="s2">"1.0.0"</span>
<span class="p">}</span>
</pre></div>

<h3>
<a name="oauth2-scopes-resource" class="anchor" href="#oauth2-scopes-resource"><span class="octicon octicon-link"></span></a>OAuth2 Scopes Resource</h3>

<p>The OAuth2 scopes value required by the RadBus API for all authenticated endpoints.</p>

<h4>
<a name="fetch-get-v1oauth2-scopes" class="anchor" href="#fetch-get-v1oauth2-scopes"><span class="octicon octicon-link"></span></a>Fetch (GET /v1/oauth2-scopes)</h4>

<h5>
<a name="sample-request-1" class="anchor" href="#sample-request-1"><span class="octicon octicon-link"></span></a>Sample Request</h5>

<pre><code>GET https://api.radbus.io/v1/oauth2-scopes
</code></pre>

<h5>
<a name="sample-success-response-1" class="anchor" href="#sample-success-response-1"><span class="octicon octicon-link"></span></a>Sample Success Response</h5>

<p><code>200 OK</code></p>

<div class="highlight highlight-json"><pre><span class="s2">"scope1 scope2"</span>
</pre></div>

<h3>
<a name="route-list-resource" class="anchor" href="#route-list-resource"><span class="octicon octicon-link"></span></a>Route List Resource</h3>

<p>A list of all available transit routes.</p>

<h4>
<a name="fetch-get-v1routes" class="anchor" href="#fetch-get-v1routes"><span class="octicon octicon-link"></span></a>Fetch (GET /v1/routes)</h4>

<h5>
<a name="sample-request-2" class="anchor" href="#sample-request-2"><span class="octicon octicon-link"></span></a>Sample Request</h5>

<pre><code>GET https://api.radbus.io/v1/routes
</code></pre>

<h5>
<a name="sample-success-response-2" class="anchor" href="#sample-success-response-2"><span class="octicon octicon-link"></span></a>Sample Success Response</h5>

<p><code>200 OK</code></p>

<div class="highlight highlight-json"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"4"</span><span class="p">,</span>
    <span class="nt">"description"</span><span class="p">:</span> <span class="s2">"4 - New Brighton - Johnson St - Bryant Av - Southtown"</span>
  <span class="p">},</span>
  <span class="err">...</span>
<span class="p">]</span>
</pre></div>

<h3>
<a name="route-details-resource" class="anchor" href="#route-details-resource"><span class="octicon octicon-link"></span></a>Route Details Resource</h3>

<p>Transit route details, including directions and stops.</p>

<h4>
<a name="fetch-get-v1routesroute" class="anchor" href="#fetch-get-v1routesroute"><span class="octicon octicon-link"></span></a>Fetch (GET /v1/routes/:route)</h4>

<h5>
<a name="sample-request-3" class="anchor" href="#sample-request-3"><span class="octicon octicon-link"></span></a>Sample Request</h5>

<pre><code>GET https://api.radbus.io/v1/routes/4
</code></pre>

<h5>
<a name="sample-success-response-3" class="anchor" href="#sample-success-response-3"><span class="octicon octicon-link"></span></a>Sample Success Response</h5>

<p><code>200 OK</code></p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
  <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"4"</span><span class="p">,</span>
  <span class="nt">"description"</span><span class="p">:</span> <span class="s2">"4 - New Brighton - Johnson St - Bryant Av - Southtown"</span><span class="p">,</span>
  <span class="nt">"directions"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"4"</span><span class="p">,</span>
      <span class="nt">"description"</span><span class="p">:</span> <span class="s2">"Northbound"</span><span class="p">,</span> 
      <span class="nt">"stops"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"82ST"</span><span class="p">,</span> 
          <span class="nt">"description"</span><span class="p">:</span> <span class="s2">"82nd St and I-35W"</span>
        <span class="p">},</span> 
        <span class="err">...</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"1"</span><span class="p">,</span>
      <span class="nt">"description"</span><span class="p">:</span> <span class="s2">"Southbound"</span><span class="p">,</span> 
      <span class="nt">"stops"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"O81A"</span><span class="p">,</span> 
          <span class="nt">"description"</span><span class="p">:</span> <span class="s2">"1st Ave NW and Old Hwy 8"</span>
        <span class="p">},</span> 
        <span class="err">...</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>

<h3>
<a name="schedule-resource" class="anchor" href="#schedule-resource"><span class="octicon octicon-link"></span></a>Schedule Resource</h3>

<p>A user's configured schedule in the RadBus system.</p>

<h4>
<a name="fetch-get-v1schedule" class="anchor" href="#fetch-get-v1schedule"><span class="octicon octicon-link"></span></a>Fetch (GET /v1/schedule)</h4>

<h5>
<a name="sample-request-4" class="anchor" href="#sample-request-4"><span class="octicon octicon-link"></span></a>Sample Request</h5>

<p>Requires <a href="#authentication">Authentication</a></p>

<pre><code>GET https://api.radbus.io/v1/schedule
Authorization: Bearer &lt;oauth2-token&gt;
</code></pre>

<h5>
<a name="sample-success-response-4" class="anchor" href="#sample-success-response-4"><span class="octicon octicon-link"></span></a>Sample Success Response</h5>

<p>If no schedule exists for the authenticated user, then a response is returned with no routes:</p>

<p><code>200 OK</code></p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
  <span class="nt">"user_display_name"</span><span class="p">:</span> <span class="s2">"Joe User"</span><span class="p">,</span>
  <span class="nt">"routes:"</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>
</pre></div>

<p>Otherwise, a response is returned that contains routes:</p>

<p><code>200 OK</code></p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
  <span class="nt">"user_display_name"</span><span class="p">:</span> <span class="s2">"Joe User"</span><span class="p">,</span>
  <span class="nt">"routes"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"4"</span><span class="p">,</span>
      <span class="nt">"description"</span><span class="p">:</span> <span class="s2">"4 - New Brighton - Johnson St - Bryant Av - Southtown"</span><span class="p">,</span>
      <span class="nt">"am"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"direction"</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">"id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="nt">"description"</span><span class="p">:</span> <span class="s2">"Southbound"</span>
        <span class="p">},</span>
        <span class="nt">"stops"</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"O81A"</span><span class="p">,</span>
            <span class="nt">"description"</span><span class="p">:</span> <span class="s2">"1st Ave NW and Old Hwy 8"</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"SLVI"</span><span class="p">,</span>
            <span class="nt">"description"</span><span class="p">:</span> <span class="s2">"Silver Lake Village"</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="nt">"pm"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"direction"</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">"id"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
          <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"Northbound"</span>
        <span class="p">},</span>
        <span class="nt">"stops"</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"7SNI"</span><span class="p">,</span>
            <span class="nt">"description"</span><span class="p">:</span> <span class="s2">"Nicollet Mall and 7th St S"</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>

<p>Sometimes configured schedule information gets outdated.  If a route, direction, or stop is no longer available, the schedule fetch call will return an additional attribute called <code>missing_data</code> which will set to <code>true</code>:</p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
  <span class="nt">"user_display_name"</span><span class="p">:</span> <span class="s2">"Joe User"</span><span class="p">,</span>
  <span class="nt">"missing_data"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">"routes"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"4"</span><span class="p">,</span>
      <span class="nt">"description"</span><span class="p">:</span> <span class="s2">"(unknown route)"</span><span class="p">,</span>
      <span class="err">...</span>
    <span class="p">},</span>
    <span class="err">...</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>

<h4>
<a name="add-route-post-v1schedule" class="anchor" href="#add-route-post-v1schedule"><span class="octicon octicon-link"></span></a>Add Route (POST /v1/schedule)</h4>

<p>Adds a single route to the authenticated user's schedule.</p>

<h5>
<a name="sample-request-5" class="anchor" href="#sample-request-5"><span class="octicon octicon-link"></span></a>Sample Request</h5>

<p>Requires <a href="#authentication">Authentication</a></p>

<pre><code>POST https://api.radbus.io/v1/schedule
Authorization: Bearer &lt;oauth2-token&gt;
Content-Type: application/json
</code></pre>

<p>The request body needs to contain a route ID and both AM and PM direction/stops:</p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
  <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"4"</span><span class="p">,</span>
  <span class="nt">"am"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"direction"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">"stops"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"O81A"</span><span class="p">,</span> <span class="s2">"SLVI"</span><span class="p">]</span>
  <span class="p">},</span>
  <span class="nt">"pm"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"direction"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="nt">"stops"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"7SNI"</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h5>
<a name="sample-success-response-5" class="anchor" href="#sample-success-response-5"><span class="octicon octicon-link"></span></a>Sample Success Response</h5>

<p><code>201 Created</code></p>

<p>Call <a href="#fetch-get-v1schedule">Fetch</a> to see the updated schedule.</p>

<h5>
<a name="failure-responses" class="anchor" href="#failure-responses"><span class="octicon octicon-link"></span></a>Failure Responses</h5>

<p><code>400 Bad Request</code>: The specified route data was invalid.  The response will contain specific validation error messages:</p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
  <span class="nt">"code"</span><span class="p">:</span> <span class="s2">"InvalidContentError"</span><span class="p">,</span>
  <span class="nt">"message"</span><span class="p">:</span> <span class="s2">"The route ID 'foo' does not exist."</span>
<span class="p">}</span>
</pre></div>

<h4>
<a name="remove-route-delete-v1scheduleroute" class="anchor" href="#remove-route-delete-v1scheduleroute"><span class="octicon octicon-link"></span></a>Remove Route (DELETE /v1/schedule/:route)</h4>

<p>Removes an existing route from the authenticated user's schedule.</p>

<h5>
<a name="sample-request-6" class="anchor" href="#sample-request-6"><span class="octicon octicon-link"></span></a>Sample Request</h5>

<p>Requires <a href="#authentication">Authentication</a></p>

<pre><code>DELETE https://api.radbus.io/v1/schedule/4
Authorization: Bearer &lt;oauth2-token&gt;
</code></pre>

<h5>
<a name="sample-success-response-6" class="anchor" href="#sample-success-response-6"><span class="octicon octicon-link"></span></a>Sample Success Response</h5>

<p><code>204 No Content</code></p>

<p>Call <a href="#fetch-get-v1schedule">Fetch</a> to see the updated schedule.</p>

<h5>
<a name="failure-responses-1" class="anchor" href="#failure-responses-1"><span class="octicon octicon-link"></span></a>Failure Responses</h5>

<p><code>400 Bad Request</code>: The specified route did not exist within the schedule.</p>

<h3>
<a name="departures-resource" class="anchor" href="#departures-resource"><span class="octicon octicon-link"></span></a>Departures Resource</h3>

<p>A list of upcoming transit departures based on the user's configured schedule.</p>

<h4>
<a name="fetch-get-v1departures" class="anchor" href="#fetch-get-v1departures"><span class="octicon octicon-link"></span></a>Fetch (GET /v1/departures)</h4>

<h5>
<a name="sample-request-7" class="anchor" href="#sample-request-7"><span class="octicon octicon-link"></span></a>Sample Request</h5>

<p>Requires <a href="#authentication">Authentication</a></p>

<pre><code>GET https://api.radbus.io/v1/departures
Authorization: Bearer &lt;oauth2-token&gt;
</code></pre>

<h5>
<a name="query-parameters" class="anchor" href="#query-parameters"><span class="octicon octicon-link"></span></a>Query Parameters</h5>

<ul>
<li>
<code>route</code> - only return departures for the specified route</li>
</ul><h5>
<a name="sample-success-response-7" class="anchor" href="#sample-success-response-7"><span class="octicon octicon-link"></span></a>Sample Success Response</h5>

<p><code>200 OK</code></p>

<div class="highlight highlight-json"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">"time"</span><span class="p">:</span> <span class="s2">"2014-05-14T14:27:00.863Z"</span><span class="p">,</span>
    <span class="nt">"route"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"270"</span><span class="p">,</span>
      <span class="nt">"terminal"</span><span class="p">:</span> <span class="s2">"C"</span>
    <span class="p">},</span> 
    <span class="nt">"stop"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"MPWD"</span><span class="p">,</span>
      <span class="nt">"description"</span><span class="p">:</span> <span class="s2">"Maplewood Mall Transit Center"</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="err">...</span>
<span class="p">]</span>
</pre></div>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">RadBus Web API maintained by <a href="https://github.com/TargetRAD">TargetRAD</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
